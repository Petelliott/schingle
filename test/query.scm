(use-modules (guest test)
             (schingle query)
             (web uri)
             (web request))

(define-test (schingle query query->alist)
  (assert-equal? (query->alist "") '())
  (assert-equal? (query->alist "a=b&c=d") '(("a" . "b") ("c" . "d")))
  (assert-equal? (query->alist "a=b&c=d&e=f") '(("a" . "b") ("c" . "d") ("e" . "f")))
  (assert-equal? (query->alist "%2B%20%5C%26%25%3D=%2B%20%5C%26%25%3D") '(("+ \\&%=" . "+ \\&%="))))

(define-test (schingle query alist->query)
  (assert-equal? (alist->query '()) "")
  (assert-equal? (alist->query '(("a" . "b") ("c" . "d"))) "a=b&c=d")
  (assert-equal? (alist->query '(("a" . "b") ("c" . "d") ("e" . "f"))) "a=b&c=d&e=f")
  (assert-equal? (alist->query '(("+ \\&%=" . "+ \\&%="))) "%2B%20%5C%26%25%3D=%2B%20%5C%26%25%3D"))

(define-test (schingle query req-query)
  (assert-equal? (req-query (build-request (string->uri "http://localhost"))) '())
  (assert-equal? (req-query (build-request (string->uri "http://localhost?a=b&c=d")))
          '(("a" . "b") ("c" . "d"))))
